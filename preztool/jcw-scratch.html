<html>
<head>
<meta charset="UTF-8"/>
<title>J Code Window</title>
<script src="qrc:///qtwebchannel/qwebchannel.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<style type="text/css">
  html, body {
    margin: 0; padding:0;
    font-family: Calibri; font-size: 28px;
    background:black; color:#fff; }
  h1 { background: gold; color: black; padding: 2px; padding-left:16px; margin:0;}
  pre { font-family: consolas;  padding-left: 16px; margin-top:1ex;}
  /* syntax highlighting for j code */
  .special { color:  limegreen }
  .copula { color: darkcyan; }
  .control { color: tomato; }
  .paren { color: #555; }
  .comment { color: #666; font-style: italic; }
  .float, .integer, .complex, .boolean, .number { color: magenta; }
  .conjunction { color: orangered; }
  .adverb { color: peru; }
  .verb { color: gold; }
  .literal { color: dodgerblue; }
  .invalid { background: red }
</style>
</head>
<body>
<div id="app">
  <h1>{{head}}</h1>
  <j-code :src="src"></j-code>
</div>
</body>
<script>
// -- vue component to highlight j code -------------
Vue.component('j-code', {
  props: ['src'],
  render: function(h) {
    return h('pre', this.src.map(function(line){
      var toks = line.map(function(tok){
        if(tok[1]===[]) return '';
        return h('span', {'class': tok[0]}, tok[1]);
      });
      toks.push('\n');
      return h('span', toks);
    }));
  }
});

var data = {head:'head goes here', src:'code goes here'},
    app = new Vue({el:"#app", data:data}),
    qcom;

// -- generic j communication driver --------------

/// this makes the connection
/// qt is supplied by "qrc:///qtwebchannel/qwebchannel.js"
new QWebChannel(qt.webChannelTransport, function(channel) {
  qcom = channel.objects.qcom;
  qcom.qNotify.connect(jnotify);
  jpost('init', '');
});


/// this sends a message to j:
function jpost(e,v) { qcom.qPost(['post', e, v]); }
function jerr(s) { jpost('err', s); }

/// this dispatches messages coming *from* j:
function jnotify(s) {
 var f = "j" + s.shift();
 if (window[f] === undefined)
  return jerr("function not found: " + f);
 window[f](s);
}


// -- api exposed to j -----------------------------

function jsrc(x) { data['src'] = JSON.parse(x); }
function jhead(x) { data['head'] = JSON.parse(x); }
function jset(k,v) { data[k] = JSON.stringify(v); }
function jget(k) { jpost('get', [k, data[k]]); }
jsrc(JSON.stringify([[['noun','ok!']]]));

document.body.addEventListener('keypress', function(e) {
  jpost('key', [e.keyCode, 0+e.shiftKey, 0+e.ctrlKey, 0+e.altKey].join(' '));
});

</script>
<script id="scratch">
  let A=[  // adverbs
    '~',   // Reflex • Passive / Evoke
    '/',   // Insert • Table
    '/.',  // Oblique • Key
    '\\',  // Prefix • Infix
    '\\.', // Suffix • Outfix
    '}',   // Item Amend • Amend
    'b.',  // Boolean / Basic
    'f.',  // Fix
    'M.',  // Memo
    't.',  // Taylor Coeff. (m t. u t.)
    't:',  // Weighted Taylor
  ]

  let C = [// Conjunctions
    '^:',  // Power (u^:n u^:v)
    '.',   // Determinant • Dot Product
    '..',  // Even
    '.:',  // Odd
    ':',   // Explicit / Monad-Dyad
    ':.',  // Obverse
    '::',  // Adverse
    ';.',  // Cut
    '!.',  // Fit (Customize)
    '!:',  // Foreign
    '"',   // Rank (m"n u"n m"v u"v)
    '`',   // Tie (Gerund)
    '`:',  // Evoke Gerund
    '@',   // Atop
    '@.',  // Agenda
    '@:',  // At
    '&',   // Bond / Compose
    '&.',  // Under (Dual)
    '&.:', // Under (Dual)
    '&:',  // Appose
    'd.',  // Derivative
    'D.',  // Derivative
    'D:',  // Secant Slope
    'H.',  // Hypergeometric
    'L:',  // Level At
    'S:',  // Spread
    'T.',  // Taylor Approximation
  ];

  let V = [ // Verbs
    '=',    // Self-Classify • Equal
    '<',    // Box • Less Than
    '<.',   // Floor • Lesser Of (Min)
    '<:',   // Decrement • Less Or Equal
    '>',    // Open • Larger Than
    '>.',   // Ceiling • Larger of (Max)
    '>:',   // Increment • Larger Or Equal
    '_:',   // Infinity
    '+',    // Conjugate • Plus
    '+.',   // Real / Imaginary • GCD (Or)
    '+:',   // Double • Not-Or
    '*',    // Signum • Times
    '*.',   // Length/Angle • LCM (And)
    '*:',   // Square • Not-And
    '-',    // Negate • Minus
    '-.',   // Not • Less
    '-:',   // Halve • Match
    '%',    // Reciprocal • Divide
    '%.',   // Matrix Inverse • Matrix Divide
    '%:',   // Square Root • Root
    '^',    // Exponential • Power
    '^.',   // Natural Log • Logarithm
    '$',    // Shape Of • Shape
    '$.',   // Sparse
    '$:',   // Self-Reference
    '~.',   // Nub •
    '~:',   // Nub Sieve • Not-Equal
    '|',    // Magnitude • Residue
    '|.',   // Reverse • Rotate (Shift)
    '|:',   // Transpose
    ',',    // Ravel • Append
    ',.',   // Ravel Items • Stitch
    ',:',   // Itemize • Laminate
    ';',    // Raze • Link
    ';:',   // Words • Sequential Machine
    '#',    // Tally • Copy
    '#.',   // Base 2 • Base
    '#:',   // Antibase 2 • Antibase
    '!',    // Factorial • Out Of
    '/:',   // Grade Up • Sort
    '\\:',   // Grade Down • Sort
    '[',    // Same • Left
    '[:',   // Cap
    ']',    // Same • Right
    '{',    // Catalogue • From
    '{.',   // Head • Take
    '{:',   // Tail •
    '{::',  //  Map • Fetch
    '}.',   // Behead • Drop
    '}:',   // Curtail •
    '".',   // Do • Numbers
    '":',   // Default Format • Format
    '?',    // Roll • Deal
    '?.',   // Roll • Deal (fixed seed)
    'A.',   // Anagram Index • Anagram
    'C.',   // Cycle-Direct • Permute
    'e.',   // Raze In • Member (In)
    'E.',   // • Member of Interval
    'i.',   // Integers • Index Of
    'i:',   // Steps • Index Of Last
    'I.',   // Indices • Interval Index
    'j.',   // Imaginary • Complex
    'L.',   // Level Of •
    'o.',   // Pi Times • Circle Function
    'p.',   // Roots • Polynomial
    'p..',  // Poly. Deriv. • Poly. Integral
    'p:',   // Primes
    'q:',   // Prime Factors • Prime Exponents
    'r.',   // Angle • Polar
    's:',   // Symbol,
    'u:',   // Unicode,
    'x:',   // Extended Precision
    '_9:',' _8:','_7:','_6:','_5:','_4:','_3:','_2:','_1:','0:',
    '9:',  '8:', '7:', '6:', '5:', '4:', '3:', '2:', '1:', //  Constant Functions
  ];

  // this remaps the short token types to
  let remap = {
    '?': 'invalid',
    'e': 'empty',
    '#': 'comment',
    '=': 'copula',
    'i': 'name', // identifier
    'y': 'special', // special names
    'p': 'paren',
    'V': 'verb',
    'A': 'adverb',
    'C': 'conjunction',
    // 'N': 'noun', // unused
    'I': 'integer',
    'B': 'boolean',
    'F': 'floating',
    '0': 'number',
    'S': 'literal', // string
  }

  let kind = {
    '(': 'p',
    ')': 'p',
    '=:': '=', // is (global)
    '=.': '=', // is (local)
    '_' : '0', // infinity
    '_.': '0', // indeterminate
    'a.': 'L', // alphabet
    'a:': 'y', // it's a boxed noun.
    'y' : 'y', // special x
    'x' : 'y', // special y
  }
  V.forEach(x => kind[x] = 'V')
  C.forEach(x => kind[x] = 'C')
  A.forEach(x => kind[x] = 'A')

  function tokTyp(tok) {
    if (kind.hasOwnProperty(tok)) return kind[tok]
    if (tok.startsWith('NB.')) return '#'
    if (tok.startsWith("'")) return 'S'
    if (tok.length === 0 || tok[0] === ' ') return 'e'
    if (tok[0].match(/^[_0123456789]$/)) return '0'
    return 'i' // assume it's a name
  }


  function ano(lines) { // annotate tokens with their types (or replace annotations that are already there)
    function fixtok(tok) {
      if (!Array.isArray(tok)) { throw "what?" }
      if (tok.length === 1) tok = [null, tok[0]];
      if (tok[1].length === 0) tok = [tok[0], ""]; // ["e", []]   (blank line)
      return [ remap[tokTyp(tok[1])], tok[1] ]
    }
    let fixline = line => line.map(fixtok)
    return lines.map(fixline)
  }

  let golf = ano([ //  golfed sandpile code
    [["load"],[" "],["'viewmat'"]],
    [["f"],[" "],["=:"],[" "],["_1 1"],[" "],["|."],["!."],["0"],["\""],["0 _"],[" "],["]"]],
    [["s"],[" "],["=:"],[" "],["("],["+"],["+"],["\/"],["@"],["("],["_4"],["&"],["*"],[","],["f"],[","],["f"],["&."],["("],["|:"],["\""],["2"],[")"],[")"],["@"],["("],["3"],["&"],["<"],[")"],[")"],["^:"],["_"]],
    [["viewmat"],[" "],["s"],[" "],["50 50"],[" "],["$"],[" "],["4"]]]);

  let orig = ano([ // original code for single animation frame
    [["settle"],[" "], ["=:"],[" "],["monad"],[" "],["define"],["          "],["NB. settle sandpiles with entries > 3"]],
    [["  "],["gt"],[" "],["=."],[" "],["y"],[" "],[">"],[" "],["3"]],
    [["  "],["up"],[" "],["=."],[" "],["}."],["   "],["gt"],[" "],[","],["  "],["0"],["            "],["NB. shift in each of the 4 directions"]],
    [["  "],["dn"],[" "],["=."],[" "],["}:"],["    "],["0"],[" "],[","],["  "],["gt"],["           "],["NB. (filling in with 0 rather than wrapping)"]],
    [["  "],["lf"],[" "],["=."],[" "],["}."],["\""],["1"],[" "],["gt"],[" "],[",."],[" "],["0"]],
    [["  "],["rt"],[" "],["=."],[" "],["}:"],["\""],["1"],[" "],["]"],["0"],[" "],[",."],[" "],["gt"]],
    [["  "],["cn"],[" "],["=."],[" "],["_4"],[" "],["*"],[" "],["gt"],["                 "],["NB. the 4 we subtract from the center"]],
    [["  "],["y"],[" "],["+"],[" "],["up"],[" "],["+"],[" "],["dn"],[" "],["+"],[" "],["lf"],[" "],["+"],[" "],["rt"],[" "],["+"],[" "],["cn"]],
    [[")"]],
    [[""]],
    [["("],["s"],[" "],["-:"],[" "],["settle"],["^:"],["_"],[")"],[" "],["50 50"],[" "],["$"],[" "],["4"],["      "],["NB. result 1 means the two have the same output."]]]);

 let slides = [ golf, orig, ].concat([
[[["i","lines"],["e"," "],["=","=:"],["e"," "],["i","LF"],["e"," "],["C","&"],["e"," "],["i","cut"]],[["e",[]]],[["i","golf"],["e"," "],["=","=:"],["e"," "],["i","lines"],["e"," "],["p","("],["B","0"],["e"," "],["C",":"],["e"," "],["B","0"],["p",")"]],[["i","load"],["e"," "],["S","'viewmat'"]],[["V","f"],["e"," "],["=","=:"],["e"," "],["I","_1 1"],["e"," "],["V","|."],["C","!."],["B","0"],["C","\""],["F","0 _"],["e"," "],["V","]"]],[["V","s"],["e"," "],["=","=:"],["e"," "],["p","("],["V","+"],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["V","f"],["V",","],["V","f"],["C","&."],["p","("],["V","|:"],["C","\""],["I","2"],["p",")"],["p",")"],["C","@"],["p","("],["I","3"],["C","&"],["V","<"],["p",")"],["p",")"],["C","^:"],["F","_"]],[["i","viewmat"],["e"," "],["V","s"],["e"," "],["I","50 50"],["e"," "],["V","$"],["e"," "],["I","4"]],[["p",")"]],[["e",[]]],[["i","run"],["e"," "],["=","=:"],["e"," "],["I","3"],["e"," "],["C",":"],["e"," "],["B","0"]],[["e","  "],["#","NB. this command runs a list of boxed J sentences in sequence"]],[["e","  "],["control","for_i."],["e"," "],["V","i."],["V","#"],["y","y"],["e"," "],["control","do."]],[["e","   "],["i","line"],["e"," "],["=","=."],["e"," "],["V",">"],["V","i"],["V","{"],["y","y"]],[["e","   "],["i","smoutput"],["e"," "],["i","line"]],[["e","   "],["V","\"."],["e"," "],["i","line"]],[["e","  "],["control","end."]],[["p",")"]],[["i","run"],["e"," "],["i","golf"]]],
[[["i","settle1"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["i","define"]],[["e","  "],["i","gt"],["e"," "],["=","=."],["e"," "],["y","y"],["e"," "],["V",">"],["e"," "],["I","3"]],[["e","  "],["i","up"],["e"," "],["=","=."],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.   y ,  0 '"],["e"," "],["i","gt"]],[["e","  "],["i","dn"],["e"," "],["=","=."],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:    0 ,  y'"],["e"," "],["i","gt"]],[["e","  "],["i","lf"],["e"," "],["=","=."],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.\"1 y ,. 0 '"],["e"," "],["i","gt"]],[["e","  "],["i","rt"],["e"," "],["=","=."],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:\"1 ]0 ,. y'"],["e"," "],["i","gt"]],[["e","  "],["i","cn"],["e"," "],["=","=."],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'_4 * y'"],["e","       "],["i","gt"]],[["e","  "],["y","y"],["e"," "],["V","+"],["e"," "],["i","up"],["e"," "],["V","+"],["e"," "],["i","dn"],["e"," "],["V","+"],["e"," "],["i","lf"],["e"," "],["V","+"],["e"," "],["i","rt"],["e"," "],["V","+"],["e"," "],["i","cn"]],[["p",")"]],[["p","("],["V","s"],["e"," "],["V","-:"],["e"," "],["i","settle1"],["C","^:"],["F","_"],["p",")"],["e"," "],["I","50 50"],["e"," "],["V","$"],["e"," "],["I","4"],["e","      "],["#","NB. result 1 means the two have the same output."]]],
[[["i","settle2"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["i","define"]],[["e","  "],["i","gt"],["e"," "],["=","=."],["e"," "],["y","y"],["e"," "],["V",">"],["e"," "],["I","3"]],[["e","  "],["i","up"],["e"," "],["=","=."],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.   y ,  0 '"]],[["e","  "],["i","dn"],["e"," "],["=","=."],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:    0 ,  y'"]],[["e","  "],["i","lf"],["e"," "],["=","=."],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.\"1 y ,. 0 '"]],[["e","  "],["i","rt"],["e"," "],["=","=."],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:\"1 ]0 ,. y'"]],[["e","  "],["i","cn"],["e"," "],["=","=."],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'_4 * y'"]],[["e","  "],["y","y"],["e"," "],["V","+"],["e"," "],["p","("],["i","up"],["e"," "],["V","+"],["e"," "],["i","dn"],["e"," "],["V","+"],["e"," "],["i","lf"],["e"," "],["V","+"],["e"," "],["i","rt"],["e"," "],["V","+"],["e"," "],["i","cn"],["p",")"],["e"," "],["i","gt"]],[["p",")"]],[["p","("],["V","s"],["e"," "],["V","-:"],["e"," "],["i","settle2"],["C","^:"],["F","_"],["p",")"],["e"," "],["I","50 50"],["e"," "],["V","$"],["e"," "],["I","4"],["e","      "],["#","NB. result 1 means the two have the same output."]]],
[[["#","NB. gt itself is a function of y, and the result is operating on y,"]],[["#","NB. so we can turn this last line into just a function composition applied to y."]],[["i","settle3"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["i","define"]],[["e","  "],["i","gt"],["e"," "],["=","=."],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'y > 3'"]],[["e","  "],["i","up"],["e"," "],["=","=."],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.   y ,  0 '"]],[["e","  "],["i","dn"],["e"," "],["=","=."],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:    0 ,  y'"]],[["e","  "],["i","lf"],["e"," "],["=","=."],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.\"1 y ,. 0 '"]],[["e","  "],["i","rt"],["e"," "],["=","=."],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:\"1 ]0 ,. y'"]],[["e","  "],["i","cn"],["e"," "],["=","=."],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'_4 * y'"]],[["e","  "],["p","("],["V","+"],["e"," "],["p","("],["i","up"],["e"," "],["V","+"],["e"," "],["i","dn"],["e"," "],["V","+"],["e"," "],["i","lf"],["e"," "],["V","+"],["e"," "],["i","rt"],["e"," "],["V","+"],["e"," "],["i","cn"],["p",")"],["C","@"],["i","gt"],["p",")"],["e"," "],["y","y"]],[["p",")"]],[["p","("],["V","s"],["e"," "],["V","-:"],["e"," "],["i","settle3"],["C","^:"],["F","_"],["p",")"],["e"," "],["I","50 50"],["e"," "],["V","$"],["e"," "],["I","4"],["e","      "],["#","NB. result 1 means the two have the same output."]]],
[[["#","NB. this is actually somewhat longer, but it puts the final expression in tacit form."]],[["#","NB. which means we could pull all these local definitions"]],[["i","gt"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'y > 3'"]],[["i","up"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.   y ,  0 '"]],[["i","dn"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:    0 ,  y'"]],[["i","lf"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.\"1 y ,. 0 '"]],[["i","rt"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:\"1 ]0 ,. y'"]],[["i","cn"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'_4 * y'"]],[["i","settle"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["i","define"]],[["e","  "],["p","("],["V","+"],["e"," "],["p","("],["i","up"],["e"," "],["V","+"],["e"," "],["i","dn"],["e"," "],["V","+"],["e"," "],["i","lf"],["e"," "],["V","+"],["e"," "],["i","rt"],["e"," "],["V","+"],["e"," "],["i","cn"],["p",")"],["C","@"],["i","gt"],["p",")"],["e"," "],["y","y"]],[["p",")"]],[["p","("],["V","s"],["e"," "],["V","-:"],["e"," "],["i","settle"],["C","^:"],["F","_"],["p",")"],["e"," "],["I","50 50"],["e"," "],["V","$"],["e"," "],["I","4"],["e","      "],["#","NB. result 1 means the two have the same output."]]],
[[["#","NB. and now we can make the final expression tacit, meaning we don't have to"]],[["#","NB. refer to local variable y, and we're just directly constructing the verb"]],[["#","NB. out of previously defined verbs."]],[["i","gt"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'y > 3'"]],[["i","up"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.   y ,  0 '"]],[["i","dn"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:    0 ,  y'"]],[["i","lf"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.\"1 y ,. 0 '"]],[["i","rt"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:\"1 ]0 ,. y'"]],[["i","cn"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'_4 * y'"]],[["i","settle"],["e"," "],["=","=:"],["e"," "],["V","+"],["e"," "],["p","("],["i","up"],["e"," "],["V","+"],["e"," "],["i","dn"],["e"," "],["V","+"],["e"," "],["i","lf"],["e"," "],["V","+"],["e"," "],["i","rt"],["e"," "],["V","+"],["e"," "],["i","cn"],["p",")"],["C","@"],["i","gt"]],[["p","("],["V","s"],["e"," "],["V","-:"],["e"," "],["i","settle"],["C","^:"],["F","_"],["p",")"],["e"," "],["I","50 50"],["e"," "],["V","$"],["e"," "],["I","4"],["e","      "],["#","NB. result 1 means the two have the same output."]]],
[[["i","settle"],["e"," "],["=","=:"],["e"," "],["V","+"],["e"," "],["p","("],["i","up"],["e"," "],["V","+"],["e"," "],["i","dn"],["e"," "],["V","+"],["e"," "],["i","lf"],["e"," "],["V","+"],["e"," "],["i","rt"],["e"," "],["V","+"],["e"," "],["i","cn"],["p",")"],["C","@"],["i","gt"]],[["e",[]]],[["V","f"],["e"," "],["=","=:"],["e"," "],["I","_1 1"],["e"," "],["V","|."],["C","!."],["B","0"],["C","\""],["F","0 _"],["e"," "],["V","]"]],[["V","s"],["e"," "],["=","=:"],["e"," "],["p","("],["V","+"],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["V","f"],["V",","],["V","f"],["C","&."],["p","("],["V","|:"],["C","\""],["I","2"],["p",")"],["p",")"],["C","@"],["p","("],["I","3"],["C","&"],["V","<"],["p",")"],["p",")"],["C","^:"],["F","_"]]],
[[["V","s"],["e"," "],["=","=:"],["e"," "],["p","("],["i","s0"],["p",")"],["C","^:"],["F","_"]],[["i","s0"],["e"," "],["=","=:"],["e"," "],["V","+"],["e"," "],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["V","f"],["V",","],["V","f"],["C","&."],["p","("],["V","|:"],["C","\""],["I","2"],["p",")"],["p",")"],["C","@"],["p","("],["I","3"],["C","&"],["V","<"],["p",")"]]],
[[["i","s0"],["e"," "],["=","=:"],["e"," "],["V","+"],["e"," "],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["V","f"],["V",","],["V","f"],["C","&."],["p","("],["V","|:"],["C","\""],["I","2"],["p",")"],["p",")"],["C","@"],["p","("],["I","3"],["C","&"],["V","<"],["p",")"],["e","    "],["#","NB. for comparison"]],[["i","s1"],["e"," "],["=","=:"],["e"," "],["V","+"],["e","    "],["p","("],["i","up"],["V","+"],["i","dn"],["V","+"],["i","lf"],["V","+"],["i","rt"],["V","+"],["i","cn"],["p",")"],["C","@"],["i","gt"],["e","         "],["#","NB. settle"]],[["e",[]]],[["#","NB. we can re-arrange the terms a bit to make them line up"]],[["e",[]]],[["i","s1"],["e"," "],["=","=:"],["e"," "],["V","+"],["e","    "],["p","("],["i","cn"],["V","+"],["i","up"],["V","+"],["i","dn"],["V","+"],["i","lf"],["V","+"],["i","rt"],["p",")"],["C","@"],["i","gt"],["e","         "],["#","NB. by commutativity of +"]],[["i","s1"],["e"," "],["=","=:"],["e"," "],["V","+"],["e","    "],["p","("],["I","_4"],["C","&"],["V","*"],["V","+"],["i","up"],["V","+"],["i","dn"],["V","+"],["i","lf"],["V","+"],["i","rt"],["p",")"],["C","@"],["p","("],["I","3"],["C","&"],["V","<"],["p",")"],["e","    "],["#","NB. inline cn and gt"]],[["e",[]]],[["i","s0"],["e"," "],["=","=:"],["e"," "],["V","+"],["e"," "],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["V","f"],["V",","],["V","f"],["C","&."],["p","("],["V","|:"],["C","\""],["I","2"],["p",")"],["p",")"],["C","@"],["p","("],["I","3"],["C","&"],["V","<"],["p",")"],["e","    "],["#","NB. for comparison"]],[["e",[]]]],
[[["y","u"],["e"," "],["=","=:"],["e"," "],["i","up"],["V",",:"],["i","dn"],["e","                          "],["#","NB. same as f"]],[["y","v"],["e"," "],["=","=:"],["e"," "],["i","lf"],["V",",:"],["i","rt"],["e","                          "],["#","NB. same as f&.(|:\"2)"]],[["i","s1"],["e"," "],["=","=:"],["e"," "],["V","+"],["e"," "],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["y","u"],["V",","],["y","v"],["p",")"],["C","@"],["p","("],["I","3"],["C","&"],["V","<"],["p",")"],["e","          "],["#","NB. we need to insert + between them"]],[["e",[]]],[["p","("],["V","s"],["e"," "],["V","-:"],["e"," "],["i","s1"],["C","^:"],["F","_"],["p",")"],["e"," "],["I","50 50"],["e"," "],["V","$"],["e"," "],["I","4"],["e","               "],["#","NB. result 1 means the two have the same output."]]],
[[["y","u"],["e"," "],["=","=:"],["e"," "],["i","up"],["V",",:"],["i","dn"],["e","                           "],["#","NB. same as f"]],[["i","s1"],["e"," "],["=","=:"],["e"," "],["V","+"],["e"," "],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["y","u"],["V",","],["y","u"],["C","&."],["p","("],["V","|:"],["C","\""],["I","2"],["p",")"],["p",")"],["C","@"],["p","("],["I","3"],["C","&"],["V","<"],["p",")"],["e","   "],["#","NB. we need to insert + between them"]],[["p","("],["V","s"],["e"," "],["V","-:"],["e"," "],["i","s1"],["C","^:"],["F","_"],["p",")"],["e"," "],["I","50 50"],["e"," "],["V","$"],["e"," "],["I","4"],["e","                "],["#","NB. result 1 means the two have the same output."]]],
[[["i","up"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.   y ,  0 '"]],[["i","dn"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:    0 ,  y'"]],[["y","u"],["e"," "],["=","=:"],["e"," "],["i","up"],["V",",:"],["i","dn"]],[["i","s0"],["e"," "],["=","=:"],["e"," "],["V","+"],["e"," "],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["V","f"],["V",","],["V","f"],["C","&."],["p","("],["V","|:"],["C","\""],["I","2"],["p",")"],["p",")"],["C","@"],["p","("],["I","3"],["C","&"],["V","<"],["p",")"]],[["e",[]]],[["V","f"],["e"," "],["=","=:"],["e"," "],["I","_1 1"],["e"," "],["V","|."],["C","!."],["B","0"],["C","\""],["F","0 _"],["e"," "],["V","]"]],[["i","s1"],["e"," "],["=","=:"],["e"," "],["V","+"],["e"," "],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["y","u"],["V",","],["y","u"],["C","&."],["p","("],["V","|:"],["C","\""],["I","2"],["p",")"],["p",")"],["C","@"],["p","("],["I","3"],["C","&"],["V","<"],["p",")"]]],
[],
[[["i","up"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.     y ,  0 '"]],[["i","dn"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:     0 ,  y'"]],[["i","lf"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.\"1   y ,. 0 '"]],[["i","rt"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:\"1 ] 0 ,. y'"]]],
[[["i","up"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.\"_   y ,  0 '"]],[["i","dn"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:\"_ ] 0 ,  y'"]],[["i","lf"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.\"1   y ,. 0 '"]],[["i","rt"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:\"1 ] 0 ,. y'"]]],
[[["V","o"],["e"," "],["=","=:"],["e"," "],["B","0"]],[["i","up"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.\"_  y ,\"_  o'"]],[["i","lf"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.\"1  y ,\"1  o'"]],[["e",[]]],[["i","dn"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:\"_  o ,\"_  y'"]],[["i","rt"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:\"1  o ,\"1  y'"]]],
[[["e","   "],["y","m"],["e"," "],["=","=:"],["e"," "],["I","5 5"],["e"," "],["V","$"],["e"," "],["F","_"]],[["e","   "],["y","m"]],[["F","_ _ _ _ _"]],[["F","_ _ _ _ _"]],[["F","_ _ _ _ _"]],[["F","_ _ _ _ _"]],[["F","_ _ _ _ _"]],[["e","   "],["p","("],["i","up"],["V",";"],["i","dn"],["V",";"],["i","lf"],["V",";"],["i","rt"],["p",")"],["e"," "],["y","m"]],[["?","\u00e2"],["?","\u0094"],["?","\u008c"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u00ac"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u00ac"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u00ac"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0090"]],[["?","\u00e2"],["?","\u0094"],["?","\u0082"],["F","_ _ _ _ _"],["?","\u00e2"],["?","\u0094"],["?","\u0082"],["B","0 0 0 0 0"],["?","\u00e2"],["?","\u0094"],["?","\u0082"],["F","_ _ _ _ 0"],["?","\u00e2"],["?","\u0094"],["?","\u0082"],["F","0 _ _ _ _"],["?","\u00e2"],["?","\u0094"],["?","\u0082"]],[["?","\u00e2"],["?","\u0094"],["?","\u0082"],["F","_ _ _ _ _"],["?","\u00e2"],["?","\u0094"],["?","\u0082"],["F","_ _ _ _ _"],["?","\u00e2"],["?","\u0094"],["?","\u0082"],["F","_ _ _ _ 0"],["?","\u00e2"],["?","\u0094"],["?","\u0082"],["F","0 _ _ _ _"],["?","\u00e2"],["?","\u0094"],["?","\u0082"]],[["?","\u00e2"],["?","\u0094"],["?","\u0082"],["F","_ _ _ _ _"],["?","\u00e2"],["?","\u0094"],["?","\u0082"],["F","_ _ _ _ _"],["?","\u00e2"],["?","\u0094"],["?","\u0082"],["F","_ _ _ _ 0"],["?","\u00e2"],["?","\u0094"],["?","\u0082"],["F","0 _ _ _ _"],["?","\u00e2"],["?","\u0094"],["?","\u0082"]],[["?","\u00e2"],["?","\u0094"],["?","\u0082"],["F","_ _ _ _ _"],["?","\u00e2"],["?","\u0094"],["?","\u0082"],["F","_ _ _ _ _"],["?","\u00e2"],["?","\u0094"],["?","\u0082"],["F","_ _ _ _ 0"],["?","\u00e2"],["?","\u0094"],["?","\u0082"],["F","0 _ _ _ _"],["?","\u00e2"],["?","\u0094"],["?","\u0082"]],[["?","\u00e2"],["?","\u0094"],["?","\u0082"],["B","0 0 0 0 0"],["?","\u00e2"],["?","\u0094"],["?","\u0082"],["F","_ _ _ _ _"],["?","\u00e2"],["?","\u0094"],["?","\u0082"],["F","_ _ _ _ 0"],["?","\u00e2"],["?","\u0094"],["?","\u0082"],["F","0 _ _ _ _"],["?","\u00e2"],["?","\u0094"],["?","\u0082"]],[["?","\u00e2"],["?","\u0094"],["?","\u0094"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u00b4"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u00b4"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u00b4"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0080"],["?","\u00e2"],["?","\u0094"],["?","\u0098"]]],
[[["i","up"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.     y ,  0 '"]],[["i","dn"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:     0 ,  y'"]],[["i","lf"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}.\"1   y ,. 0 '"]],[["i","rt"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}:\"1 ] 0 ,. y'"]]],
[[["i","up"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}. y , 0'"]],[["i","dn"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}: 0 , y'"]],[["i","lf"],["e"," "],["=","=:"],["e"," "],["i","up"],["C","\""],["B","1"]],[["i","rt"],["e"," "],["=","=:"],["e"," "],["i","dn"],["C","\""],["B","1"]],[["e",[]]],[["y","u"],["e"," "],["=","=:"],["e"," "],["i","up"],["V",",:"],["i","dn"]],[["y","v"],["e"," "],["=","=:"],["e"," "],["i","lf"],["V",",:"],["i","rt"],["e","        "],["#","NB. this still works"]],[["y","v"],["e"," "],["=","=:"],["e"," "],["i","up"],["C","\""],["B","1"],["V",",:"],["i","rt"],["C","\""],["B","1"],["e","    "],["#","NB. or this, but not (v =: u\"1)"]]],
[[["y","u"],["e"," "],["=","=:"],["e"," "],["i","up"],["V",",:"],["i","dn"]],[["y","v"],["e"," "],["=","=:"],["e","  "],["V","|:"],["C","&"],["i","up"],["C","&"],["V","|:"],["e","  "],["V",",:"],["e","  "],["V","|:"],["C","&"],["i","dn"],["C","&"],["V","|:"],["e","        "],["#","NB. transpose each side before and after"]],[["y","v"],["e"," "],["=","=:"],["e"," "],["p","("],["V","|:"],["C","&"],["i","up"],["e","     "],["V",",:"],["e","  "],["V","|:"],["C","&"],["i","dn"],["p",")"],["C","&"],["V","|:"],["e","       "],["#","NB. we can factor out the \"before\" part"]],[["y","v"],["e"," "],["=","=:"],["e"," "],["p","("],["V","|:"],["C","\""],["I","2"],["p",")"],["C","&"],["p","("],["e"," "],["i","up"],["e"," "],["V",",:"],["e"," "],["i","dn"],["e"," "],["p",")"],["C","&"],["V","|:"],["e","         "],["#","NB. to factor out \"after\", we have to apply at rank 2 because it's now rank 3"]],[["y","v"],["e"," "],["=","=:"],["e"," "],["p","("],["V","|:"],["C","\""],["I","2"],["p",")"],["C","&"],["p","("],["i","up"],["V",",:"],["i","dn"],["p",")"],["C","&"],["p","("],["V","|:"],["C","\""],["I","2"],["p",")"],["e","         "],["#","NB. it's safe to put rank 2 on the \"before\" part. now the before and after are the same."]],[["y","v"],["e"," "],["=","=:"],["e"," "],["p","("],["i","up"],["V",",:"],["i","dn"],["p",")"],["C","&."],["p","("],["V","|:"],["C","\""],["I","2"],["p",")"],["e","               "],["#","NB. now we can use \"under\""]],[["y","v"],["e"," "],["=","=:"],["e"," "],["y","u"],["C","&."],["p","("],["V","|:"],["C","\""],["I","2"],["p",")"]],[["e",[]]],[["i","s1"],["e"," "],["=","=:"],["e"," "],["V","+"],["e"," "],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["y","u"],["V",","],["y","v"],["p",")"],["C","@"],["p","("],["I","3"],["C","&"],["V","<"],["p",")"]],[["i","viewmat"],["e"," "],["i","s1"],["C","^:"],["F","_"],["e"," "],["V","]"],["e"," "],["I","50 50"],["e"," "],["V","$"],["e"," "],["I","4"]]],
[[["i","s1"],["e"," "],["=","=:"],["e"," "],["V","+"],["e"," "],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["y","u"],["V",","],["y","u"],["C","&."],["p","("],["V","|:"],["C","\""],["I","2"],["p",")"],["p",")"],["C","@"],["p","("],["I","3"],["C","&"],["V","<"],["p",")"]]],
[[["i","up"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}. y , 0'"]],[["i","dn"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}: 0 , y'"]],[["y","u"],["e"," "],["=","=:"],["e"," "],["i","up"],["V",",:"],["i","dn"]],[["e",[]]],[["V","f"],["e"," "],["=","=:"],["e"," "],["I","_1 1"],["e"," "],["V","|."],["C","!."],["B","0"],["C","\""],["F","0 _"],["e"," "],["V","]"]],[["e",[]]],[["i","s1"],["e"," "],["=","=:"],["e"," "],["V","+"],["e"," "],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["y","u"],["V",","],["y","u"],["C","&."],["p","("],["V","|:"],["C","\""],["I","2"],["p",")"],["p",")"],["C","@"],["p","("],["I","3"],["C","&"],["V","<"],["p",")"]],[["i","s0"],["e"," "],["=","=:"],["e"," "],["V","+"],["e"," "],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["V","f"],["V",","],["V","f"],["C","&."],["p","("],["V","|:"],["C","\""],["I","2"],["p",")"],["p",")"],["C","@"],["p","("],["I","3"],["C","&"],["V","<"],["p",")"]],[["e",[]]],[["p","("],["V","s"],["e"," "],["V","-:"],["e"," "],["i","s1"],["C","^:"],["F","_"],["p",")"],["e"," "],["I","50 50"],["e"," "],["V","$"],["e"," "],["I","4"]]],
[[["e","   "],["V","i."],["e"," "],["I","3 3"]],[["I","0 1 2"]],[["I","3 4 5"]],[["I","6 7 8"]],[["e",[]]],[["e","   "],["B","1"],["e"," "],["V","|."],["e"," "],["V","i."],["e"," "],["I","3 3"]],[["I","3 4 5"]],[["I","6 7 8"]],[["I","0 1 2"]],[["e",[]]],[["e","   "],["I","_1"],["e"," "],["V","|."],["e"," "],["V","i."],["e"," "],["I","3 3"]],[["I","6 7 8"]],[["I","0 1 2"]],[["I","3 4 5"]]],
[[["e","   "],["B","1"],["e"," "],["V","|."],["C","!."],["F","_"],["e"," "],["V","i."],["e"," "],["I","3 3"]],[["I","3 4 5"]],[["I","6 7 8"]],[["F","_ _ _"]]],
[[["i","up"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}. y , 0'"]],[["i","dn"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'}: 0 , y'"]],[["e",[]]],[["i","up"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","' 1 |.!.0 y'"]],[["i","dn"],["e"," "],["=","=:"],["e"," "],["i","monad"],["e"," "],["C",":"],["e"," "],["S","'_1 |.!.0 y'"]]],
[[["i","up"],["e"," "],["=","=:"],["e","  "],["B","1"],["e"," "],["V","|."],["C","!."],["B","0"],["e"," "],["V","]"]],[["i","dn"],["e"," "],["=","=:"],["e"," "],["I","_1"],["e"," "],["V","|."],["C","!."],["B","0"],["e"," "],["V","]"]],[["y","u"],["e"," "],["=","=:"],["e"," "],["i","up"],["V",",:"],["i","dn"]]],
[[["e","   "],["V","|."],["A","b."],["B","0"]],[["F","_ 1 _"]]],
[[["y","u"],["e"," "],["=","=:"],["e"," "],["I","1 _1"],["e"," "],["V","|."],["C","!."],["B","0"],["C","\""],["F","0 _"],["e"," "],["V","]"]],[["V","f"],["e"," "],["=","=:"],["e"," "],["I","_1 1"],["e"," "],["V","|."],["C","!."],["B","0"],["C","\""],["F","0 _"],["e"," "],["V","]"]]],
[[["i","jw"],["=","=:"],["p","("],["V","+"],["V","[:"],["p","("],["I","_4"],["C","&"],["V","*"],["V","+"],["V","[:"],["V","+"],["A","\/"],["p","("],["p","("],["V",","],["V","-"],["p",")"],["p","("],["V",",:"],["V","|."],["p",")"],["B","0 1"],["p",")"],["V","|."],["C","!."],["B","0"],["V","]"],["p",")"],["I","3"],["C","&"],["V","<"],["p",")"],["C","^:"],["F","_"],["e","     "],["#","NB. jitwit's version"]],[["p","("],["V","s"],["e"," "],["V","-:"],["e"," "],["i","jw"],["p",")"],["e"," "],["I","5 5"],["e"," "],["V","$"],["e"," "],["I","4"]]],
[[["i","sj"],["e"," "],["=","=:"],["p","("],["V","+"],["e"," "],["V","[:"],["e"," "],["p","("],["I","_4"],["C","&"],["V","*"],["V","+"],["V","[:"],["V","+"],["A","\/"],["p","("],["p","("],["V",","],["V","-"],["p",")"],["p","("],["V",",:"],["V","|."],["p",")"],["B","0 1"],["p",")"],["V","|."],["C","!."],["B","0"],["V","]"],["p",")"],["e"," "],["I","3"],["C","&"],["V","<"],["p",")"],["e","     "],["#","NB. remove the ^:_"]],[["e",[]]],[["i","sj"],["e"," "],["=","=:"],["e"," "],["V","+"],["e"," "],["V","[:"],["e"," "],["p","("],["I","_4"],["C","&"],["V","*"],["V","+"],["V","[:"],["V","+"],["A","\/"],["p","("],["p","("],["V",","],["V","-"],["p",")"],["p","("],["V",",:"],["V","|."],["p",")"],["B","0 1"],["p",")"],["V","|."],["C","!."],["B","0"],["V","]"],["p",")"],["e"," "],["I","3"],["C","&"],["V","<"],["e","      "],["#","NB. drop parens"]],[["#","NB.   _ __ ________________________________ ___    4 verbs"]],[["#","NB.   _ ___________________________   2 verbs"]],[["i","s0"],["e"," "],["=","=:"],["e"," "],["V","+"],["e"," "],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["V","f"],["V",","],["V","f"],["C","&."],["p","("],["V","|:"],["C","\""],["I","2"],["p",")"],["p",")"],["C","@"],["p","("],["I","3"],["C","&"],["V","<"],["p",")"]]],
[],
[[["i","up"],["e"," "],["=","=:"],["e","  "],["B","1"],["e"," "],["V","|."],["C","!."],["B","0"],["e"," "],["V","]"]],[["i","dn"],["e"," "],["=","=:"],["e"," "],["I","_1"],["e"," "],["V","|."],["C","!."],["B","0"],["e"," "],["V","]"]],[["y","u"],["e"," "],["=","=:"],["e"," "],["i","up"],["V",",:"],["i","dn"]]],
[[["i","up"],["e"," "],["=","=:"],["e","  "],["B","1 0"],["e"," "],["V","|."],["C","!."],["B","0"],["e"," "],["V","]"]],[["i","dn"],["e"," "],["=","=:"],["e"," "],["I","_1 0"],["e"," "],["V","|."],["C","!."],["B","0"],["e"," "],["V","]"]],[["i","lf"],["e"," "],["=","=:"],["e","  "],["B","0 1"],["e"," "],["V","|."],["C","!."],["B","0"],["e"," "],["V","]"]],[["i","rt"],["e"," "],["=","=:"],["e","  "],["I","0 _1"],["V","|."],["C","!."],["B","0"],["e"," "],["V","]"]],[["y","u"],["e"," "],["=","=:"],["e"," "],["i","up"],["V",",:"],["i","dn"]],[["y","v"],["e"," "],["=","=:"],["e"," "],["i","lf"],["V",",:"],["i","rt"]]],
[[["V","g"],["e"," "],["=","=:"],["e"," "],["y","u"],["V",","],["y","v"]],[["V","g"],["e"," "],["=","=:"],["e"," "],["p","("],["B","1 0"],["V",","],["e"," "],["I","_1 0"],["V",","],["e"," "],["B","0 1"],["V",",:"],["e"," "],["I","0 _1"],["p",")"],["e"," "],["V","|."],["C","!."],["B","0"],["e"," "],["V","]"]],[["i","s1"],["e"," "],["=","=:"],["e"," "],["V","+"],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["V","g"],["p",")"],["C","@"],["p","("],["I","3"],["C","&"],["V","<"],["p",")"]],[["p","("],["V","s"],["e"," "],["V","-:"],["e"," "],["i","s1"],["C","^:"],["F","_"],["p",")"],["e"," "],["I","5 5"],["e"," "],["V","$"],["e"," "],["I","4"]]],
[[["y","n"],["e"," "],["=","=:"],["e"," "],["I","4 2"],["V","$"],["I","0 1 1 0 0 _1 _1 0"]],[["y","n"],["e"," "],["=","=:"],["e"," "],["B","0 1"],["V",","],["e"," "],["B","1 0"],["V",","],["e"," "],["I","0 _1"],["V",",:"],["e"," "],["I","_1 0"]],[["y","n"],["e"," "],["=","=:"],["e"," "],["p","("],["V",","],["V","-"],["p",")"],["p","("],["V",",:"],["V","|."],["p",")"],["B","0 1"]]],
[[["i","jw"],["e"," "],["=","=:"],["e"," "],["V","+"],["V","[:"],["p","("],["I","_4"],["C","&"],["V","*"],["V","+"],["V","[:"],["V","+"],["A","\/"],["y","n"],["V","|."],["C","!."],["B","0"],["V","]"],["p",")"],["I","3"],["C","&"],["V","<"]],[["i","s1"],["e"," "],["=","=:"],["e"," "],["V","+"],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["y","n"],["V","|."],["C","!."],["B","0"],["V","]"],["p",")"],["C","@"],["p","("],["I","3"],["C","&"],["V","<"],["p",")"],["e","   "],["#","NB. (f g@h)  <-->  (f[:g h)"]],[["i","s1"],["e"," "],["=","=:"],["e"," "],["V","+"],["V","[:"],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["y","n"],["V","|."],["C","!."],["B","0"],["V","]"],["p",")"],["I","3"],["C","&"],["V","<"],["e","    "],["#","NB. shaves off one character by swapping [: for @()"]],[["p","("],["V","s"],["e"," "],["V","-:"],["e"," "],["i","s1"],["C","^:"],["F","_"],["p",")"],["e"," "],["I","5 5"],["e"," "],["V","$"],["e"," "],["I","4"]]],
[[["y","n"],["e"," "],["=","=:"],["e"," "],["p","("],["V",","],["V","-"],["p",")"],["p","("],["V",",:"],["V","|."],["p",")"],["B","0 1"]],[["y","n"],["e"," "],["=","=:"],["e"," "],["p","("],["V",","],["V","-"],["p",")"],["V","="],["A","\/"],["A","~"],["V","i."],["I","2"]],[["y","n"],["e"," "],["=","=:"],["e"," "],["p","("],["V",","],["V","-"],["p",")"],["I","2"],["V","]"],["A","\\"],["V","i:"],["B","1"]]],
[[["i","s1"],["e"," "],["=","=:"],["e"," "],["V","+"],["V","[:"],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["p","("],["p","("],["V",","],["V","-"],["p",")"],["I","2"],["V","]"],["A","\\"],["V","i:"],["B","1"],["p",")"],["V","|."],["C","!."],["B","0"],["V","]"],["p",")"],["I","3"],["C","&"],["V","<"]]],
[[["i","load"],["e"," "],["S","'viewmat'"]],[["V","d"],["e"," "],["=","=:"],["e"," "],["B","0 1"],["V",","],["e"," "],["B","1 0"],["V",","],["e"," "],["I","0 _1"],["V",",:"],["e"," "],["I","_1 0"],["e","          "],["#","NB. directions to shift"]],[["V","s"],["e"," "],["=","=:"],["e"," "],["V","+"],["e"," "],["V","[:"],["e"," "],["V","+"],["A","\/"],["C","@"],["p","("],["I","_4"],["C","&"],["V","*"],["V",","],["e"," "],["V","d"],["V","|."],["C","!."],["B","0"],["V","]"],["p",")"],["e"," "],["I","3"],["C","&"],["V","<"],["e","    "],["#","NB. sandpiles step"]],[["i","viewmat"],["e"," "],["V","s"],["C","^:"],["F","_"],["e"," "],["V","["],["e"," "],["I","50 50"],["e"," "],["V","$"],["e"," "],["I","4"]]]
    ].map(x => ano(x)));

  slide = i => data['src']=slides[i].slice()
  slide(1)

  let ints = i => { let r = []; for (let j=0;j<i;j++) r.push(j); return r }
  let str = tok => tok[1]
  let typ = toks => toks.map(t=>t[0])
  let txt = toks => toks.map(t=>t[1])
  let line = toks => toks.map(str).join('')
  let ins = (a,i,x)=> a.slice(0,i).concat(x).concat(a.slice(i))
  function exmo(li, nm) {  // li: line of tokens,  nm: variable name
    let sp = 5  // start position
    let ep = -2 // end position -- strip trailing ws and comma ( TODO: fix this )
    let re = RegExp("\\b" + nm + "\\b") // only match name when it's a complete word
    let mo = ("'" + txt(li.slice(sp,ep)).join('') + "'").replace(re, 'y')  // extracted monad as string
    let ws = ['empty', ' '] // whitespace (one space char)
    return li.slice(0,sp).concat([['noun','monad'],ws,['conjunction',':'],ws,['literal', mo],ws,['name',nm], ws]);
  }



  // ---- scratch ---------------------------------


  // sample animation with web animation api
  //let h1 = document.getElementsByTagName('h1')[0]
  //let an = h1.animate({color:'red'},{duration: 1000, fill:'forwards'})
  //an.commitStyles()
  //an.persist()

  // animations from the web animation api only provide transformations of
  // individual numeric or color attributes. They do not allow modifying the
  // dom in arbitrary ways, such as changing an element's text or re-grouping
  // elements.
  //
  // Since we want to do these things in our animations, we need an extended
  // language that allows arbitrary behaviors.
  //
  // My animations are structures (js classes) with three functions on {dt, t},
  // where t is a "timestamp" (a number between 0 and 1), and dt is the change
  // in t since the last rendered frame.
  //
  class Animation {
    t0(dt) {}     // called when t=0
    t1(dt) {}     // called when t=1
    ts(dt, t) {}} // called on every other step of the animation.

  // We'll assume that time can move in either direction by any amount.
  // From a UI perspective, imagine a single horizontal timeline with a
  // cursor that can be dragged (or "scrubbed") left and right with the mouse.
  //
  // Shorter timelines can be nested inside longer timelines. (From the
  // UI perspective, these would probably show up as separate horizontal
  // lines beneath the main timeline, something like a Gantt chart.
  //
  // Each timeline treats time as an interval between 0 and 1, and the
  // top-level t and dt variables are scaled and shifted appropriately
  // when calling functions for the nested timelines. Likewise, dt is
  // truncated to the range -1 ... 1, so that scrubbing past one end or
  // the other of the timeline never results in large values being passed
  // to t0 or t1.

  class TSpan {  // time span
    constructor(t0, dur) {
      self.t0  = t0;   // start time
      self.dur = dur; // duration
    }
  }

  // constructor(dur) { self.dur = dur; } // duration, in ms

  class ASeq extends Animation {
    // sequence several animations one after another.
    constructor(seq) {
      super(sum(seq.map(a => a.dur)));
      this.seq = seq; }
    t0(dt) { this.seq[0].t0(dt) }
    ts(dt,t) { }
    t1(dt) { this.seq[this.seq.length-1].t1(dt) }
  }

  class TEvent { // 0-duration timeline event
    fwd() { }    // run the event fwd
    bkw() { }}   // undo the event


  // extract monad as single timeline event
  class ExMoEvt extends TEvent {
    constructor(i, nm) { super(); this.i = i; this.nm = nm }
    fwd() {
      var lines = slides[1]
      Vue.set(data.src, this.i, exmo(lines[this.i], this.nm)) }
  }


  class Player {
    constructor(seq) { this.t = 0; this.i = 0; this.seq = seq; }
    step() { this.seq[this.i++]() }
    play() { if (this.i < this.seq.length) { this.step(); setTimeout(_ => this.play(), 100); }}}


  function run() {
    let evts = ints(5).map(i => i+2).map(i => new ExMoEvt(i, 'gt'))
    // evts.forEach(e => e.fwd())
    let p = new Player(evts.map(e => _ => e.fwd()))
    p.play()
  }




</script>
</html>
